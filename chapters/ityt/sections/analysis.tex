\section{Security Analysis}\label{sect:analysis}
\begin{comment}
This section describes our protocol from a game theory standpoint and analyzes a configuration of $(k,n) = (2,3)$. 

\begin{itemize}
	\item In our solution, we do not deal with a trusted third party but we leverage the use of the blockchain. This introduces several unknown actors that cannot be considered as trusted. A blockchain itself assumes that 50\%+1 participants are honest, otherwise the history of the ledger could be forked and currency could be double spent.

	\item Our system enforces remuneration and disincentive strategies in order to regulate actions of users.

	\item The underlying mechanism of regulation is a non sum zero game. This means that expected value received by users when they behave honestly is supposed to be positive (negative on the contrary), with negative disincentive being more penalizing that the positive benefit that they could receive.
\end{itemize}

\mg{Sketch of security analysis}

We have four players: $\owner, \shareholder_1, \shareholder_2, \shareholder_3$.

\begin{itemize}

\item[\textbf{Players $\owner, \shareholder_1, \shareholder_2, \shareholder_3$ are controlled by distinct users:}]
	%
	There are two cases:
	\begin{itemize}
	\item [\textbf{Owner $\owner$ is honest:}]
	%
	There are three cases depending on whether shareholders collude:
	%
	\begin{itemize}
	\item [\textbf{No collusion:}]
	%
	Each shareholder $\shareholder_i$ has only two options.
	%
	\begin{itemize}
	\item [\textbf{Honest behavior}:]
	%
	The  payoff is $-\BH + \RH$.
	%
	Observe that $-\BH + \RH > 0$ (since $\RH - \BH > 0$ see equation ??).
	
	\item [\textbf{Whistleblow share $\share_i$}:]
	%
	The  payoff is $-\BH +  \Wbonus_{\share}$.
	%
	Observe that $-\BH +  \Wbonus_{\share} < 0$ (since ...).\df{\mg{Missing constraint?} Dario, can you check this?}
	\end{itemize}
	%
	Hence, a rational shareholder will follow the protocol and disclose his share only at $\td$.
	
	
	\item  [\textbf{Two shareholders collude:}]
	%
	For simplicity, we assume that $\shareholder_1$ and $\shareholder_2$ collude, while $\shareholder_3$ does not collude (other groups of colluding shareholders can be handled in an analogous way).
	%
	The analysis for the non-colluding user $\shareholder_3$ is similar as before, hence $\shareholder_i$ will follow the protocol and disclose $\share_3$ only at $\td$.
	%
	The colluding users $\shareholder_1$ and $\shareholder_2$ have multiple alternatives:
	\begin{itemize}
		\item [\textbf{Honest behavior}:]
		%
		The coalition payoff is $-2\BH + 2\RH$.
		%
		Observe that $-2\BH + 2\RH > 0$ since $\RH - \BH > 0$.
		
		\item [\textbf{$\shareholder_1$ behaves honestly and $\shareholder_2$ whistleblows $\share_2$}:]
		%
		The coalition payoff is $-2\BH + \RH + \Wbonus_{\share}$.
		%
		Observe that $-2\BH + 2\RH > 0$ since $\RH - \BH > 0$ and \mg{Missing constraint $-\BH +  \Wbonus_{\share} < 0$?}.
		
		
		\item [\textbf{$\shareholder_2$ behaves honestly and $\shareholder_1$ whistleblows $\share_1$}:]
		%
		Same as case above.
		
		\item [\textbf{$\shareholder_1, \shareholder_2$  whistleblow $\secret$}:]
		%
		The coalition payoff is $-2\BH + \Wbonus_{\secret}$.
		%
		Payoff is negative (see (3)).
		
		\item [\textbf{$\shareholder_1, \shareholder_2$  sell $\secret$}:]
		%
		The coalition payoff is $-2\BH + V$.
		%
		Payoff is negative (see (3)).
		
		\item[\mg{Unclear scenarios:}]
		I'm not sure if the following scenarios make sense. \mg{Input/comments needed}
		
		\begin{itemize}
			\item[\textbf{Both wbl. shares and S and sell secret:}]
			%
			The coalition payoff is $-2\BH + 2\Wbonus_{\share} + \Wbonus_{\secret} + V$.
			
			\mg{This seems the worst case!}

			%
			\mg{Can shareholders whistleblow both shares and secret to get more whistleblowing rewards? I guess they might do that using MPC + other contracts?}
			\EB{when you whistleblow the secret it becomes public, so nobody would pay you \V to know it. Dario, Have we addedd to the constraints something to prevent this? As in whistleblowing shares + secret? maybe something like the maximum reward is k-1 shares + secret and then add a check to the function above?}
			
			\item[\textbf{Whistleblow secret and sell secret:}]
			%
			The coalition payoff is $-2\BH + \Wbonus_{\secret} + V$.
			%
			\mg{Can shareholders whistleblow the secret and sell it at the same time? (Wouldn't secret be public then?)} 
			\EB{yep, public, we don't have to deal with that.}
		\end{itemize}
		
		
	\end{itemize}

	\item  [\textbf{Three shareholders collude:}]
	%
	Alternatives:
	%
	\begin{itemize}
		\item [\textbf{Honest behavior}:]
		%
		The coalition payoff is $-3\BH + 3\RH$.
		%
		Observe that $-3\BH + 3\RH > 0$ since $\RH - \BH > 0$.
		
		
		\item[\textbf{All whistleblow shares and secret and sell secret:}]
		%
		The coalition payoff is $-3\BH + 3\Wbonus_{\share} + \Wbonus_{\secret} + V$.
		
		\item[\textbf{$\shareholder_1$ behaves honestly and $\shareholder_2, \shareholder_3$ whblow shares}:] 
		%
		The coalition payoff is $-3\BH + \RH + 2\Wbonus_{\share}$.
		%
		Observe that $-3\BH + \RH + 2\Wbonus_{\share} > 0$ since $\RH - \BH > 0$ and \mg{Missing constraint $-\BH +  \Wbonus_{\share} < 0$?}.\EB{Dario, could you check?}
		
		\item [\textbf{$\shareholder_1$ behaves honestly and $\shareholder_2$ whistleblows $\share_2$}:]
		%
		The coalition payoff is $-2\BH + \RH + \Wbonus_{\share}$.
		%
		Observe that $-2\BH + 2\RH > 0$ since $\RH - \BH > 0$ and \mg{Missing constraint $-\BH +  \Wbonus_{\share} < 0$?}.\EB{Dario, here also}
		
		
		\item [\textbf{Other cases}:]
		%
		They should all be subsumed by cases above so not so interesting. We can spell them out alter.
		
		
	\end{itemize}


	\end{itemize}
	
	 
	\item [\textbf{Owner $\owner$ is dishonest:}]	
	\mg{What is the goal of a dishonest owner $\owner$?}
	\EB{To set up a fake game to gain shareholder's money}
	\end{itemize}

\item[\textbf{Players $\owner, \shareholder_1, \shareholder_2, \shareholder_3$ are not controlled by distinct users:}]
%
\mg{How to address this? Interesting?}
\EB{as in all of them the same? yep sure, we just have to show that it's not a zero-sum game (i.e., burn some money)}
	
\end{itemize}


\subsection{Sketch}
\end{comment}

\newcommand{\wait}{\mathtt{wait}}
\newcommand{\wShare}[1]{\mathtt{wbShare}(#1)}
%\newcommand{\wSecret}[1]{\mathtt{wbSecret}(#1)}
\newcommand{\wSecret}{\mathtt{wbSecret}}
\newcommand{\nxt}[1]{\mathtt{nxt}(#1)}
\newcommand{\coalitionActions}[1]{\overline{A(#1)}}
\newcommand{\schedulerActions}{\coalitionActions{s}}
\newcommand{\coalitionSchema}{\mathcal{C}}
\newcommand{\finishgame}{\mathtt{end}}
\newcommand{\elt}[2]{#1[#2]}
\newcommand{\prefix}[2]{#1\mathord{\mid}_{#2}}
\newcommand{\disclosed}[1]{\mathit{discl}(#1)}
\newcommand{\disclosedByCoalition}[2]{\mathit{discl}(#1,#2)}
\newcommand{\Nat}{\mathbb{N}}
\newcommand{\payoffs}{\mathit{payoffs}}
\newcommand{\honest}{\mathit{honest}}
\newcommand{\game}[1]{\mathcal{G}(#1)}
\newcommand{\tup}[1]{\langle #1 \rangle}
\newcommand{\rounds}{R}
\newcommand{\emptysequence}{\varepsilon}
\newcommand{\concat}{\cdot}
\newcommand{\powerset}[1]{2^{#1}}
\newcommand{\remaining}[3]{\mathit{rem}(#1,#2,#3)}
\newcommand{\cleanGlobalAction}[2]{\mathit{clean}(#1,#2)}
\newcommand{\cleanExecution}[1]{\mathit{clean}(#1)}
\newcommand{\cleanSingleAction}[4]{\mathit{clean}(#1,#2,#3,#4)}
\newcommand{\disclosedBefore}[2]{\mathit{disclPrec}(#1,#2)}
\newcommand{\conflict}[1]{\mathit{res}(#1)}
\newcommand{\conflictExec}[2]{\mathit{res}(#1,#2)}
\newcommand{\conflictAction}[2]{\mathit{res}(#1,#2)}
\newcommand{\updateDM}[2]{\mathit{upd}(#1,#2)}
\newcommand{\valid}[1]{\mathit{valid}(#1)}
\newcommand{\disclosedUpdated}[3]{\mathit{disclUpd}(#1,#2,#3)}
\newcommand{\partialUpdateDM}[3]{\mathit{upd}(#1,#2,#3)}
\newcommand{\update}[1]{\mathit{upd}(#1)}
\newcommand{\updPrec}[3]{\mathit{updPrec}(#1,#2,#3)}
\newcommand{\predecessor}[1]{\mathit{prec}(#1)}
\newcommand{\outcome}[1]{O(#1)}
\newcommand{\subgameOutcome}[2]{O_{#2}(#1)}


This section, analyzes the interaction among coalitions using game theory to prove that they are incentivized to stick to honest behavior.

\para{Assumptions}
%
We make the following assumptions:
\begin{compactenum} 
\item The owner is honest (i.e., she is not part of the game).

\item After $\td$, all shareholders immediately disclose their secrets (we only model the behavior from when the contract's state is set to \texttt{LOCKED} to $\td$).

\item Players in the game consists of disjoint groups of shareholders.
%
That is, each player in our game represents a coalition of one or more shareholders.
%
These shareholders cooperate and split their rewards (cooperation is enforced through external contracts).
%
We assume that these coalitions are common knowledge among the players.

\item We assume that each player has 3 actions: 
\begin{itemize}
\item \textit{Wsecret} denoting the disclosure of the secret (and its selling).
\item \textit{Wshare(S)} denoting the disclosure of a subset $S$ of the shares controlled by the player.
\item \textit{Wait} denoting that the player waits, i.e., delays his action.
\end{itemize}

\item We assume that players execute their moves in rounds and that the possible number of rounds is known beforehand by all players.
%
At each round, each player can perform one move. 
%
Players' moves are committed and registered on the blockchain only at the end of the round.
%
Finally, we assume that players are aware of all actions performed in the past rounds (since they are visible in the blockchain).
%
Hence, we model the ITYT as an extensive game with perfect knowledge and simultaneous moves. 

\item We assume that whenever there are conflicts between actions in the same round (e.g., two players both whistleblowing the secret), these actions are resolved following a predefined order between the players.

\end{compactenum}

\para{Shareholders}
%
$\shareholder = \{\shareholder_1, \ldots, \shareholder_n\}$ is a set of shareholders.

\para{Rounds}
%
$\rounds$ denotes the number of rounds.

\para{Sharing scheme}
%
We consider an \shortname instance with $k-n$ secret sharing.

\para{Coalition Schemas}
%
A coalition schema $\coalitionSchema$ over $\shareholder$ consists of a partition of $\shareholder$, i.e., a set $\coalitionSchema = \{ C_1, \ldots, C_m\}$ such that $\bigcup_{i}C_i = \shareholder$, $C_i \cap C_j = \emptyset$ whenever $i \neq j$, and $C_i \neq \emptyset$ for all $i$, and a total order $\preceq$ over $\coalitionSchema$.
%
In the following, we fix a coalition schema $\tup{\coalitionSchema,\preceq}$.


\para{Coalition's actions}
%
A coalition $C \in \coalitionSchema$ can perform actions from the set $\coalitionActions{C} := \{\wait, \wSecret \} \cup \{ \wShare{S} \mid S \subseteq C \wedge S \neq \emptyset\}$. % \cup \{ \wSecret{S} \mid S \subseteq C\}$.

\para{Global actions}
%
A global action is a function $a: \coalitionSchema \to \bigcup_{C \in \coalitionSchema} \coalitionActions{C}$ mapping each coalition $C \in \coalitionSchema$ to an action in $\coalitionActions{C}$.

\para{Executions}
%
An execution is a finite sequence of global actions.
%
%Given a coalition schema $\coalitionSchema$, an execution is a finite sequence $s_1a_1s_2a_2 \ldots s_na_n$ such that for all $1 \leq i \leq n$, $s_i \in \schedulerActions$ and there exists a $C \in \coalitionSchema$ such that $a_i \in \coalitionActions{C}$.
%
%Given an execution $e$, $\disclosedByCoalition{e}{C}$ denotes the set of all shares disclosed in $e$ by coalition $C$, i.e., 
%$\disclosedByCoalition{e}{C} = \emptyset$ and $\disclosedByCoalition{a \concat e}{C} = \begin{cases} S \cup \disclosedByCoalition{e}{C} & \text{if}\ a(C) = \wShare{S}\\ \disclosedByCoalition{e}{C} & \text{otherwise} \end{cases}$.
%%
%Moreover, $\disclosed{e}$ the set of all shares disclosed in $e$, i.e., $\disclosed{e} = \bigcup_{C \in \coalitionSchema} \disclosedByCoalition{e}{C}$.
%
We say that an execution $e$ is valid for the coalition schema $\tup{\coalitionSchema,\preceq}$ and rounds $\rounds$ if $|e| \leq \rounds$ and all global actions $a$ in $e$ maps each coalition $C \in \coalitionSchema$ to an action in $\coalitionActions{C}$.
%
We denote by $VE(\tup{\coalitionSchema,\preceq},\rounds)$ the set of all valid executions for the coalition schema $\tup{\coalitionSchema,\preceq}$ and rounds $\rounds$.
%
Moreover, we denote by $VTE(\tup{\coalitionSchema,\preceq},\rounds)$ the set of all \textit{terminal} valid executions for the coalition schema $\tup{\coalitionSchema,\preceq}$ and rounds $\rounds$, i.e., the valid executions of length $\rounds$.


\para{Conflict-resolution}
%
Executions may contain conflicts, such as two players trying to claim the whistleblow reward for the secret.
%
Such events are handled by the conditional checks in ITYT, e.g., in Algorithm~\ref{??}, in such a way that only one of the requests is processed while the other is ignored.
%
In Figure~\ref{figure:conflict-resolution}, we introduce a conflict resolution function $\conflict{e}$ which models ITYT conflict resolution behavior. 
%
This allows us to simplify the definition of the payoff function.



\begin{figure*}
\begin{align*}
	dm_0 &= \lambda C \in \coalitionSchema.\ \emptyset\\
	\conflict{e} &= \conflictExec{e}{dm_0}\\
	\conflictExec{a \concat e}{dm} &= \conflictAction{a}{dm} \concat \conflictExec{e}{\updateDM{a}{dm}}\\
	\conflictExec{\emptysequence}{dm} &= \emptysequence\\
	\conflictAction{a}{dm} & =  \lambda C \in \coalitionSchema.
	\begin{cases}
		\wait & \text{if}\ \neg \valid{\updPrec{a}{dm}{C}}\\
		\wait & \text{if}\ \valid{\updPrec{a}{dm}{C}} \wedge a(C) = \wait \\
		\wShare{S'} & \text{if}\ \valid{\updPrec{a}{dm}{C}} \wedge a(C) = \wShare{S} \wedge \\
		& \quad S'\ \text{is largest subset of}\ S\ \text{s.t.}\ |S \cup \disclosed{\updPrec{a}{dm}{C}}| \leq k \\
		\wSecret & \text{if}\ \valid{\updPrec{a}{dm}{C}} \wedge a(C) = \wSecret \wedge |C \cup \disclosed{dm}| \geq k \\
		\wait & \text{if}\ \valid{\updPrec{a}{dm}{C}} \wedge a(C) = \wSecret \wedge |C \cup \disclosed{dm}| < k \\
	\end{cases}
	\\
	\updateDM{a}{dm} & = \lambda C \in \coalitionSchema.\ \partialUpdateDM{a}{dm}{C}(C) \\
	\partialUpdateDM{a}{dm}{C}& = \lambda C' \in \coalitionSchema.
	\begin{cases}
 		dm(C') & \text{if}\ C' \succ C \\
 		\partialUpdateDM{a}{dm}{C'} & \text{if}\ C' \prec C\\
 		dm(C') &  \text{if}\ C' = C \wedge \neg \valid{\updPrec{a}{dm}{C}}  \\	
 		dm(C') &  \text{if}\ C' = C \wedge \valid{\updPrec{a}{dm}{C}} \wedge a(C') = \wait \\
 		dm(C') \cup S' &  \text{if}\ C' = C \wedge \valid{\updPrec{a}{dm}{C}} \wedge a(C') = \wShare{S} \wedge \\
 			& \quad S'\ \text{is largest subset of}\ S\ \text{s.t.}\ |S \cup \disclosed{\updPrec{a}{dm}{C}}| \leq k \\
 		dm(C') \cup \{\secret\} &  \text{if}\ C' = C \wedge \valid{\updPrec{a}{dm}{C}} \wedge a(C') = \wSecret \wedge \\
 			& \quad |C \cup \disclosed{dm}| \geq k \\	 		 
 		dm(C')  &  \text{if}\ C' = C \wedge \valid{\updPrec{a}{dm}{C}} \wedge a(C') = \wSecret \wedge \\
 			& \quad |C \cup \disclosed{dm}| < k \\	
 	\end{cases}\\
	\updPrec{a}{dm}{C} &= 
	\begin{cases}
		dm & \text{if}\ \neg \exists C'.\ C' \prec C\\
		\partialUpdateDM{a}{dm}{\predecessor{C}}	 & \text{otherwise}
	\end{cases}
	\\
	\predecessor{C} &= \text{largest}\ (\text{w.r.t.}\ \prec)\ C'\ \text{such that}\ C' \prec C \\
	\valid{dm} &= \secret \not\in \bigcup_{C \in \coalitionSchema} dm(C) \wedge |\disclosed{dm}| < k \\
	\disclosed{dm} &= (\bigcup_{C \in \coalitionSchema} dm(C)) \setminus \{\secret\}\\
	\updateDM{\emptysequence}{dm} &= dm\\
	\updateDM{e \concat a}{dm} &= \updateDM{a}{\updateDM{e}{dm}}\\
	\update{e} &= \updateDM{e}{dm_0}
\end{align*}
\caption{Conflict resolution}\label{figure:conflict-resolution}
\end{figure*}


%
%
%\begin{figure*}
%\begin{align*}
%\disclosedBefore{a}{C} &= \bigcup_{S' \in \{S' \mid \exists C'. C' \prec C \wedge a(C') = \wShare{S'} \}} S' \\
%\cleanSingleAction{\wait}{C}{k}{a} & = \wait \\
%\cleanSingleAction{\wShare{S}}{C}{k}{a} & = \begin{cases}
% \wait 	& \text{if}\  \exists C',S'.\ C' \prec C \wedge a(C') = \wSecret{S'}\\	
% \wait 	& \text{if}\  | \disclosedBefore{a}{C} | \geq k \\
% \wShare{\mathit{first}(S, k - | \disclosedBefore{a}{C} | )} & \text{if}\ 0 < k - | \disclosedBefore{a}{C} | < |S|   \\ 
% \wShare{S} & \text{otherwise}
%\end{cases}\\
%\cleanSingleAction{\wSecret{S}}{C}{k}{a} & = \begin{cases}
% \wait 	& \text{if}\  \exists C',S'.\ C' \prec C \wedge a(C') = \wSecret{S'}\\	
% \wait 	& \text{if}\  | \disclosedBefore{a}{C} | \geq k \\
% \wSecret{\mathit{first}(S, k - | \disclosedBefore{a}{C} | )} & \text{if}\ 0 < k - | \disclosedBefore{a}{C} | < |S|   \\ 
% \wSecret{S} & \text{otherwise}
%\end{cases}\\
%\cleanGlobalAction{a}{k} & = \lambda C \in \coalitionSchema.
%\begin{cases}
% \wait 	& \text{if}\ a(C) = \wait\\
% %
% % \wShare{S}
% \wait 	& \text{if}\ a(C) = \wShare{S} \wedge \exists C',S'.\ C' \prec C \wedge a(C') = \wSecret{S'}\\	
% \wait 	& \text{if}\ a(C) = \wShare{S} \wedge | \bigcup_{ \substack{S' \in \{S' \mid \exists C'. C' \prec C \wedge \\ a(C') = \wShare{S'} \} }} S'| \geq k \\
%% \wShare{S'} & \text{if} a(C) = \wShare{S} \wedge S' \subseteq S \wedge 
%% 
%% \wSecret{S}
% \wait 	& \text{if}\ a(C) = \wSecret{S} \wedge \exists C',S'.\ C' \prec C \wedge a(C') = \wSecret{S'}\\	
% \wait 	& \text{if}\ a(C) = \wSecret{S} \wedge | \bigcup_{ \substack{S' \in \{S' \mid \exists C'. C' \prec C \wedge \\ a(C') = \wShare{S'} \} }} S'| \geq k \\
% \end{cases}
%\\
%\cleanExecution{e} & = \prefix{e}{|e|-1} \concat \cleanGlobalAction{\elt{e}{|e|}}{ |\disclosed{\prefix{e}{|e|-1}}|  }
%\end{align*}
%\caption{Conflict resolution}\label{figure:conflict-resolution}
%\end{figure*}




%\para{Valid Executions}
%%
%We now characterize all valid executions for a coalition schema $\tup{\coalitionSchema,\preceq}$ and rounds $\rounds$, i.e., those modeling ITYT executions.
%%
%We say that an execution $e$ is a \textit{valid execution} iff the following conditions hold:
%\begin{itemize}
%\item $|e| \leq \rounds$.
%\item For all $1 \leq i \leq |e|$ and $C \in \coalitionSchema$:
%\begin{itemize}
%\item Whenever $\elt{e}{i}(C)  = \wSecret{S}$:
%\begin{itemize}
%\item $|C \cup \disclosed{\prefix{e}{i-1}}| \geq k$.
%\item $|S \cup \disclosed{\prefix{e}{i-1}}| < k$.
%\item $i = |e|$.
%\end{itemize}
%\item Whenever $\elt{e}{i}(C)  = \wShare{S}$:
%\begin{itemize}
%\item $S \cap \disclosedByCoalition{\prefix{e}{i-1}}{C} = \emptyset$.
%\item $|S \cup \disclosed{\prefix{e}{i-1}}| \leq k$.
%\item if $|S \cup \disclosed{\prefix{e}{i-1}}| = k$, then $i = |e|$
%\end{itemize}
%\end{itemize}
%\end{itemize}
%%
%We denote by $VE(\tup{\coalitionSchema,\preceq},\rounds)$ the set of all valid executions for the coalition schema $\tup{\coalitionSchema,\preceq}$ and rounds $\rounds$.
%%
%Moreover, we denote by $VTE(\tup{\coalitionSchema,\preceq},\rounds)$ the set of all \textit{terminal} valid executions for the coalition schema $\tup{\coalitionSchema,\preceq}$ and rounds $\rounds$, i.e., those executions for which all extensions are not valid executions.




\para{Payoffs}
%
The payoff function $\payoffs: VTE(\tup{\coalitionSchema,\preceq},\rounds) \to (\coalitionSchema \to \Nat)$ is defined as $\payoffs(e) = \payoffs'(\conflict{e}, \update{e})$, where $\payoffs'(e,dm)$ is given in Figure~\ref{figure:payoff}.
\begin{figure*}
\begin{align*}
	\payoffs'(e,dm)& = \lambda C \in \coalitionSchema. \begin{cases}
 		V + \Wbonus_s + (|dm(C)| -1) \cdot \Wbonus_h - |C| \cdot \BH & \text{if}\  \neg \valid{dm} \wedge \secret \in dm(C)\\
 		|dm(C)|\cdot \Wbonus_h - |C| \cdot \BH & \text{if}\  \neg \valid{dm} \wedge \secret \not\in dm(C)\\
 		(|C| - |dm(C)|) \cdot \RH + |dm(C)| \cdot \Wbonus_h - |C| \cdot \BH & \text{if}\  \valid{dm}
 	\end{cases}	
\end{align*}
\caption{Payoff function}\label{figure:payoff}
\end{figure*}

%
%
%
%
%\begin{itemize}
%\item If $\elt{e}{|e|}(C)  = \wSecret{S}$, then:
%\begin{itemize}
%
%\item $\payoffs(e)(C)$ is $V + \Wbonus_s + (|\disclosedByCoalition{\prefix{e}{|e|-1}}{C}|+\remaining{k}{e}{C}) \cdot \Wbonus_h - |C| \cdot \BH$ if there is no $C' \prec C$ for which $\elt{e}{|e|}(C')  = \wSecret{S'}$ and $(|\disclosedByCoalition{\prefix{e}{|e|-1}}{C}|++\remaining{k}{e}{C}) \cdot \Wbonus_h - |C| \cdot \BH$ otherwise.
%
%\item $\payoffs(e)(C')$, for $C' \neq C$, is $V + \Wbonus_s + (|\disclosedByCoalition{\prefix{e}{|e|-1}}{C}|+\remaining{k}{e}{C}) \cdot \Wbonus_h - |C| \cdot \BH$ if there is no $C' \prec C$ for which $\elt{e}{|e|}(C')  = \wSecret{S'}$ and $(|\disclosedByCoalition{\prefix{e}{|e|-1}}{C}|++\remaining{k}{e}{C}) \cdot \Wbonus_h - |C| \cdot \BH$ otherwise.
%\textcolor{red}{MARCO: Fix remaining to account for order between wShare and wSecret}
%\end{itemize}
%	
%\end{itemize}
%
%
%
%\begin{itemize}
%\item If there is an $i$ such that 	$\elt{e}{|e|-2} = \nxt{C}$ and $\elt{e}{|e|-1}  = \wSecret{S}$, then:
%\begin{itemize}
%\item $\payoffs(e)(C) = |S| \cdot \Wbonus_h + V + \Wbonus_s - |C| \cdot \BH$.
%\item $\payoffs(e)(C') = |\disclosedByCoalition{e}{C'}| \cdot  \Wbonus_h - |C'| \cdot \BH$ for all $C' \in \coalitionSchema\setminus\{C\}$.
%\end{itemize}
%\item If $|\disclosed{e}| = k$, then: % This is implicit:  $\forall S \subseteq \mathcal{H}.\ \wSecret{S} \not\in e$
%\begin{itemize}
%\item $\payoffs(e)(C) = |\disclosedByCoalition{e}{C}| \cdot  \Wbonus_h - |C| \cdot \BH$ for all $C \in \coalitionSchema$.
%\end{itemize}
%\item Otherwise:
%\begin{itemize}
%\item $\payoffs(e)(C) = |\disclosedByCoalition{e}{C}| \cdot  \Wbonus_h + |C \setminus \disclosedByCoalition{e}{C}| \cdot \RH  - |C| \cdot \BH$ for all $C \in \coalitionSchema$.
%\end{itemize}
%\end{itemize}

\para{Player function}
%
The player function for a coalition schema $\tup{\coalitionSchema,\preceq}$ is the function $P: VE(\tup{\coalitionSchema,o},\rounds) \to \powerset{\coalitionSchema}$ defined as follows:
%
$P(e) = \coalitionSchema$ for all $e$.


\para{Game}
%
Given a coalition schema $\tup{\coalitionSchema,\preceq}$ and rounds $\rounds$,  $\game{\tup{\coalitionSchema,\preceq},\rounds}$ is the extensive game with perfect information and simultaneous moves where the set of players is $\coalitionSchema$, the set of histories is $VE(\tup{\coalitionSchema,\preceq},\rounds)$, the set of terminal histories is $VTE(\tup{\coalitionSchema,\preceq},\rounds)$, the player function is $P$, and the preference relation $\preceq_C$, for each player $C \in \coalitionSchema$, is as follows: $e \preceq e'$ iff $\payoffs(e)(C) \leq_C \payoffs(e')(C)$.



\para{Strategy}
%
A \textit{strategy} for the game $\game{\tup{\coalitionSchema,\preceq},\rounds}$ and player $C \in \coalitionSchema$ is a function $s_C$ that assigns to each execution $e \in VE(\tup{\coalitionSchema,\preceq},\rounds) \setminus FVE(\tup{\coalitionSchema,\preceq},\rounds)$ such that $C \in P(e)$ an action $a \in \coalitionActions{C}$.
%
A \textit{strategy profile} is a function $s$ mapping each player $C \in \coalitionSchema$ to a strategy $s_C$. 

Given a strategy profile $s$ and an execution $e$, we denote by $s(e)$ the global action $a$ defined as $\lambda C \in \coalitionSchema.\ s(C)(e)$.
%
The outcome of a strategy profile $s$, written $\outcome{s}$, is the terminal history $a_1 \cdot a_2 \cdot \ldots \cdot a_\rounds$ defined as follows:
%
$a_1 = s(\emptysequence)$, $a_2 = s(a_1)$, $a_3 = s( a_1 \cdot a_2)$, \ldots, $a_\rounds = s(a_1 \cdot a_2 \cdot \ldots \cdot a_{\rounds-1})$.


Given a strategy profile $s$ and two executions $e,e'$, $s_e(e')$ is the global action $\lambda C \in \coalitionSchema.\ s(C)(e\concat e')$.
%
The outcome of a strategy $s$ given an execution $e$, written $\subgameOutcome{s}{e}$, is $e \concat a_1 \concat a_2 \concat \ldots \concat a_{\rounds - |e|}$ such that $a_1 = s_e(\emptysequence)$, $a_2 = s_e(a_1)$, $a_3 = s_e( a_1 \cdot a_2)$, \ldots, $a_{\rounds - |e|} = s_e(a_1 \cdot a_2 \cdot \ldots \cdot a_{\rounds - |e|-1})$.

The \textit{honest strategy $\honest_C$ for the player $C \in \coalitionSchema$} is the function mapping each execution $e \in V(\coalitionSchema) \setminus FV(\coalitionSchema)$ such that $P(e) = C$ to the action $\wait$.




\para{Correctness}
%
Theorem~\ref{theorem:honest-is-equilibrium} states that the strategy $\lambda C \in \coalitionSchema.\ \honest_C$ is an  equilibrium for the game $\game{\tup{\coalitionSchema, \preceq}, \rounds}$, i.e., rational agents will not deviate from it.


\begin{theorem}\label{theorem:honest-is-equilibrium}
Let $\tup{\coalitionSchema, \preceq}$ be a coalition schema and $\rounds$ be a number of rounds.
%
If the following condition hold:
$$\RH > V + \Wbonus_s + (k -1) \cdot \Wbonus_h \wedge \RH > \BH$$
then the strategy $\lambda C \in \coalitionSchema.\ \honest_C$ is a sub-game perfect equilibrium for the game $\game{\tup{\coalitionSchema, \preceq}, \rounds}$.
\end{theorem}

\begin{proof}
Let $\tup{\coalitionSchema, \preceq}$ be a coalition schema and $\rounds$ be a number of rounds.
%
Moreover, we assume that $\RH > V + \Wbonus_s + (k -1) \cdot \Wbonus_h \wedge \RH > \BH$ hold.
%
In the following, $\honest$ denotes the strategy $\lambda C \in \coalitionSchema.\ \honest_C$.
%
To show that $\honest$ is a unique sub-game perfect equilibrium for the game $\game{\tup{\coalitionSchema, \preceq}, \rounds}$, we need to show that for all non-terminal execution $e \in VE(\tup{\coalitionSchema,\preceq},\rounds) \setminus FVE(\tup{\coalitionSchema,\preceq},\rounds)$, players $C \in \coalitionSchema$, and strategy $s$, $\payoffs(\subgameOutcome{\honest}{e})(C) \geq \payoffs(\subgameOutcome{\honest[C \mapsto s]}{e})(C)$.
%
Thanks to the so-called ``one deviation property''~\cite[Lemma 98.2]{osborne1994course} and given that $\game{\tup{\coalitionSchema, \preceq}, \rounds}$ is a finite-horizon game, to show that $\honest$ is a unique sub-game perfect equilibrium is enough showing that for all non-terminal execution $e \in VE(\tup{\coalitionSchema,\preceq},\rounds) \setminus FVE(\tup{\coalitionSchema,\preceq},\rounds)$, players $C \in \coalitionSchema$, and actions $a \in \coalitionActions{C}$, $\payoffs(\subgameOutcome{\honest}{e})(C) \geq \payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)$.

Let $e$ be an arbitrary non-terminal execution $e \in VE(\tup{\coalitionSchema,\preceq},\rounds) \setminus FVE(\tup{\coalitionSchema,\preceq},\rounds)$, $C \in \coalitionSchema$ be a player, and $a \in \coalitionActions{C}$ be an action.
%
We now show that $\payoffs(\subgameOutcome{\honest}{e})(C) \geq \payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)$.
%
There are two cases:
\begin{itemize}
\item[$\neg \valid{\update{e}}$: ]
%
We claim that (1) $\conflict{\subgameOutcome{\honest}{e})(C)} = \conflict{\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)}$ (since the $\conflict{\cdot}$ function will map all actions after $e$ to $\lambda C \in \coalitionSchema.\ \wait$), and (2) $\update{\subgameOutcome{\honest}{e})(C)} = \update{\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)}$ (since all applications of $\update{\cdot}$ after $e$ will not modify the disclosure mapping $dm$).
%
From this and $\payoffs(e) = \payoffs'(\conflict{e}, \update{e})$, we immediately get that $\payoffs(\subgameOutcome{\honest}{e})(C) = \payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)$.

\textcolor{red}{TODO: Prove claims (1) and (2)!}

\item[$\valid{\update{e}}$: ]
%
There are three cases:
\begin{itemize}
\item[$a = \wait$:]
%
Then, $\honest = \honest[C \mapsto \honest(C)[e \mapsto a]]$ and, therefore, $\payoffs(\subgameOutcome{\honest}{e})(C) = \payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)$.

\item[$a = \wShare{S}$:]
%
Let $a_h$ be the global action produced according to the strategy profile $\honest$ and $a'$ be the action produced according to the profile $\honest[C \mapsto \honest(C)[e \mapsto a]$.
%
That is, $a_h = \lambda C \in \coalitionSchema.\ \wait$ while $a'= a_h[C \mapsto a]$.
%
We claim that  $ \updPrec{a'}{\update{e}}{C} =  \updPrec{a_h}{\update{e}}{C}$.
%
Let $dm$ be the disclosure mapping $\updPrec{a_h}{\update{e}}{C}$.
%
Observe that $\valid{dm}$ holds since $\valid{\update{e}}$ holds and all players $C' \prec C$ select the move $\wait$ according to both $a_h$ and $a'$.
%
Moreover, observe that $\secret \not\in dm(C)$ since $\valid{\update{e}}$ holds and all players $C' \prec C$ select the move $\wait$ according to both $a_h$ and $a'$.
%
There are two cases:
\begin{itemize}
\item[$|S \cup \disclosed{dm}| \geq k$:]
%
Let $S'$ be the largest subset of $S$ such that $|S \cup \disclosed{dm}| \leq k$.
%
Then, $\payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)$ is equivalent to  $|dm(C)| \cdot \Wbonus_h - |C| \cdot \BH$.
%
Hence, we have that:
%
	\begin{align*}
			&\payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C) \\
			&\ = |dm(C)| \cdot \Wbonus_h - |C| \cdot \BH \\  
			&\ < |dm(C)| \cdot \RH - |C| \cdot \BH \\	% \BH < \RH
			&\ \leq |C| \cdot \RH - |C| \cdot \BH \\	% |dm(C)| \leq |C| by construction (since $\secret \not\in dm(C)$)
			&\ = \payoffs(\subgameOutcome{\honest}{e})(C) % because |dm'(C)| = 0 since all users are honest
	\end{align*}
%
\item[$|S \cup \disclosed{dm}| < k$:] 
%
Then, $\payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C) = (|C| - |dm(C)|) \cdot \RH + |dm(C)| \cdot \Wbonus_h - |C| \cdot \BH$ (because $\valid{\update{\subgameOutcome{\honest}{e})(C) = \payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e}}}$ holds).
%
Hence, we have that:
	\begin{align*}
			&\payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C) \\
			&\ = (|C| - |dm(C)|) \cdot \RH + |dm(C)| \cdot \Wbonus_h - |C| \cdot \BH \\  
			&\ < (|C| - |dm(C)|) \cdot \RH + |dm(C)| \cdot \RH - |C| \cdot \BH \\	% \BH < \RH
			&\ = |C|  \cdot \RH - |C| \cdot \BH \\ 
			&\ = \payoffs(\subgameOutcome{\honest}{e})(C) % because |dm'(C)| = 0 since all users are honest
	\end{align*}


\end{itemize}

\textcolor{red}{TODO: Prove claim $ \updPrec{a'}{\update{e}}{C} =  \updPrec{a_h}{\update{e}}{C}$}

\item[$a = \wSecret$:]
%
Let $a_h$ be the global action produced according to the strategy profile $\honest$ and $a'$ be the action produced according to the profile $\honest[C \mapsto \honest(C)[e \mapsto a]$.
%
That is, $a_h = \lambda C \in \coalitionSchema.\ \wait$ while $a'= a_h[C \mapsto \wSecret]$.
%
There are two cases:
\begin{itemize}
\item[$|C \cup \disclosed{dm}| < k$:]
%
Then, $\conflictAction{a_h}{\update{e}} = \conflictAction{a'}{\update{e}}$ since the conflict resolution replaces $\wSecret$ with $\wait$.
%
Therefore, $\payoffs(\subgameOutcome{\honest}{e})(C) = \payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)$.


\item[$|C \cup \disclosed{dm}| \geq k$:]	
%
Then, $\conflictAction{a'}{\update{e}} = \conflictAction{a_h}{\update{e}}[C \mapsto \wSecret]$.
%
Therefore,  $\payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C)$ is $V + \Wbonus_s + (|dm(C)| -1) \cdot \Wbonus_h - |C| \cdot \BH$.
%
Hence, we have that:
	\begin{align*}
			&\payoffs(\subgameOutcome{\honest[C \mapsto \honest(C)[e \mapsto a]]}{e})(C) \\
			&\ = V + \Wbonus_s + (|dm(C)| -1) \cdot \Wbonus_h - |C| \cdot \BH \\  
			&\ <  V + \Wbonus_s + (|dm(C)| -1) \cdot \Wbonus_h - |C| \cdot \BH \\	% \BH < \RH
			&\ \leq  V + \Wbonus_s + (k -1) \cdot \Wbonus_h - |C| \cdot \BH \\ % |dm(C)| - 1 \leq k-1
			&\ \leq  \RH - |C| \cdot \BH \\ % RH > V + \Wbonus_s + (k -1) \cdot \Wbonus_h			
			&\ \leq |C|  \cdot \RH - |C| \cdot \BH \\ % since |C| \geq 1
			&\ = \payoffs(\subgameOutcome{\honest}{e})(C) % because |dm'(C)| = 0 since all users are honest
	\end{align*}
\end{itemize}
\end{itemize}
\end{itemize}
\end{proof}

Theorem~\ref{} states that all strategy profiles $s$ that are equilibria are such that $O(s) = \honest_{trace}$, where $\honest_{trace}$ is the execution where all players keep playing $\wait$.

\begin{theorem}
Let $\tup{\coalitionSchema, \preceq}$ be a coalition schema and $\rounds$ be a number of rounds.
%
For all strategy profiles $s$, 
%
if $s$ is a sub-game perfect equilibrium for $\game{\tup{\coalitionSchema, \preceq}, \rounds}$, then
%
$\outcome{s} = a_1 \cdot a_2 \cdot \ldots \cdot a_{\rounds}$ where for all $1 \leq i \leq \rounds$ and all $C \in \coalitionSchema$, $a_i(C) = \wait$.
\end{theorem}

\begin{proof}
Let $\tup{\coalitionSchema, \preceq}$ be a coalition schema and $\rounds$ be a number of rounds.
%
Moreover, let $s$ be a sub-game perfect equilibrium for $\game{\tup{\coalitionSchema, \preceq}, \rounds}$.
%
Assume, for contradiction's sake, that $\outcome{s} \neq a_1 \cdot a_2 \cdot \ldots \cdot a_{\rounds}$ where for all $1 \leq i \leq \rounds$ and all $C \in \coalitionSchema$, $a_i(C) = \wait$.
%
Hence, there is a prefix of $a_1 \cdot a_2 \cdot \ldots \cdot a_{\rounds}$ such that the strategy profile results in an action that is different from $\lambda C \in \coalitionSchema.\ \wait$.
%
Let $e$ be such a prefix.
%
We know that $s \neq \honest$ (otherwise the outcome would have ben exactly $a_1 \cdot a_2 \cdot \ldots \cdot a_{\rounds}$ where for all $1 \leq i \leq \rounds$ and all $C \in \coalitionSchema$, $a_i(C) = \wait$).
%

\end{proof}





\begin{comment}
\para{Whistleblowing choices}
%
A whistleblowing choice $w$ for a coalition $C$ is a function $w : C \to 2^{\shareholder}$ such that $w(C) = C'$ such that $C' \subseteq C$.

\para{Ordering}
%
An ordering $O$ for a coalition $C$ is a permutation of $C$.

\para{Strategies}
%
A strategy $s$ for a coalition $C$ is a function $s : \{1, \ldots, |C|\} \to \{ wShare, wSecret, wait\}$.
%
We denote by $honest$ the strategy picking the action $wait$ for all  $i$.


\para{Valid strategies}
%
A strategy $s$ is valid for a coalition $C$, an ordering $O$, and a $w$ if the following conditions are satisfied:
%
\begin{itemize}
\item Whenever $s(i) = wSecret$, then $|O[i] \cup \bigcup_{j < i} ( w(O[j]) \cap \{ h \in \shareholder \mid s(j) = wShare \}	)| \geq k$.
\item Whenever $s(i) = wSecret$, then $|w(O[i]) \cup \bigcup_{j < i} ( w(O[j]) \cap \{ h \in \shareholder \mid s(j) = wShare \}	)| \leq k-1$.
\item Whenever $s(i) = wSecret$, then for all $j \neq i$, $s(j) \neq wSecret$.
\item Whenever $s(i) = wSecret$, then for all $j > i$, $s(j) = wait$.
\item Whenever $s(i) = wShare$, then $|w(O[i]) \cup \bigcup_{j < i} ( w(O[j]) \cap \{ h \in \shareholder \mid s(j) = wShare \}	)| \leq k$.
\item Whenever $s(i) = wShare$, if $|w(O[i]) \cup \bigcup_{j < i} ( w(O[j]) \cap \{ h \in \shareholder \mid s(j) = wShare \}	)| = k$, then for all $j > i$, $s(j) = wait$.
\end{itemize}



\para{Payoffs}
%
The payoff function for a valid strategy $s$ given $C$, $O$, and $w$ is defined as follows:
%
\begin{itemize}
\item Whenever $s(i) = wait$, then 
\begin{itemize}
\item if there is no $l$ such that (1) $s(l) = wSecret$, or (2) $s(j) = wShare$ and $|w(O[l]) \cup \bigcup_{j < l} ( w(O[j]) \cap \{ h \in \shareholder \mid s(j) = wShare \}	)| = k$, then $\payoffs(C,O,w,s)[i] = |O[i]| \cdot (\RH - \BH)$.
\item otherwise  $\payoffs(C,O,w,s)[i] = - |O[i]| \cdot \BH$.
\end{itemize}
\item Whenever $s(i) = wShare$, then: 
\begin{itemize}
\item if there is no $l$ such that (1) $s(l) = wSecret$, or (2) $s(j) = wShare$ and $|w(O[l]) \cup \bigcup_{j < l} ( w(O[j]) \cap \{ h \in \shareholder \mid s(j) = wShare \}	)| = k$, then $\payoffs(C,O,w,s)[i] = |w(O[i])| \cdot \Wbonus_\shareholder + (|O[i]| - |w(O[i])|) \cdot \RH - |O[i]| \cdot \BH $.
\item otherwise $\payoffs(C,O,w,s)[i] = |w(O[i])| \cdot \Wbonus_\shareholder - |O[i]| \cdot \BH $.
\end{itemize}
\item Whenever $s(i) = wSecret$, then $\payoffs(C,O,w,s)[i] = |w(O[i])| \cdot \Wbonus_\shareholder  + V + \Wbonus_\secret  - |O[i]| \cdot \BH $.	
\end{itemize}

\para{Nash equilibrium}
%
A strategy $s$ is a Nash equilibrium for $C$, $O$, and $w$ if for all strategies $s'$, if $s' = s[i \mapsto a]$, then $\mathit{payoffs}(C, O, w, s') \leq \mathit{payoffs}(C,O,w, s)$.


\para{Correctness 1}
We want to prove that for all coalition $C$, all whistleblowing choices $w$, and all orderings $O$, the strategy $\honest$ is a Nash equilibrium.

Let $C$ be a coalition, $w$ be a choice for $C$, and $O$ be an ordering for $C$.
%
Moreover, let $s$ be an arbitrary valid strategy such that $s = \honest[i \mapsto a]$ for some index $i$ and action $a$.
%
We claim that $\mathit{payoffs}(C, O, w, s') \leq \mathit{payoffs}(C,O,w, \honest)$.
%
Since $C$, $w$, $O$, and $s$ are all picked arbitrarily, $\honest$ is a Nash equilibrium for all $C$, $w$, and $O$.

We now show that $\mathit{payoffs}(C, O, w, s') \leq \mathit{payoffs}(C,O,w, \honest)$.
%
Observe that for all $j \neq i$, $\mathit{payoffs}(C, O, w, s')[j] = \mathit{payoffs}(C,O,w, \honest)[j]$, so we just need to show that  $\payoffs(C, O, w, s')[i] < \payoffs(C,O,w, \honest)[i]$.
%
Observe also that $\payoffs(C,O,w, \honest)[i] = |O[i]| \cdot (\RH - \BH)$.
%
There are two cases:
\begin{itemize}
	\item[$a = wShare$:]
	%
	Then, $\mathit{payoffs}(C,O,w, s)[i]$ is either $\payoffs(C,O,w,s)[i] = |w(O[i])| \cdot \Wbonus_\shareholder + (|O[i]| - |w(O[i])|) \cdot \RH - |O[i]| \cdot \BH $ (if $|w(O[i])| = k$) or $|w(O[i])| \cdot \Wbonus_\shareholder - |O[i]| \cdot \BH $ (if $|w(O[i])| < k$) since all other players' actions are $wait$.
	%
	In the first case, we have:
	\begin{equation*}
		\begin{split}
			\payoffs(C,O,w, s)[i] 
			&= |w(O[i])| \cdot \Wbonus_\shareholder + \\
			& \qquad (|O[i]| - |w(O[i])|) \cdot \RH \\
			& \qquad - |O[i]| \cdot \BH \\
			&= k \cdot \Wbonus_\shareholder + (|O[i]| - k) \cdot \RH \\
			& \qquad - |O[i]| \cdot \BH \\ % |w(O[i])| = k
			&\leq  k \cdot \BH + (|O[i]| - k) \cdot \RH \\
			& \qquad - |O[i]| \cdot \BH \\ % \Wbonus_\shareholder < \BH
			&\leq  k \cdot \RH + (|O[i]| - k) \cdot \RH \\
			& \qquad - |O[i]| \cdot \BH \\ % BH < RH
			&=  |O[i]| (\RH - \BH) \\ 
			&= 	\payoffs(C,O,w, honest)[i]	
		\end{split}
	\end{equation*}
	%
	In the second case, we have:
	\begin{equation*}
		\begin{split}
	\payoffs(C,O,w, s)[i] 
	&= |w(O[i])| \cdot \Wbonus_\shareholder - |O[i]| \cdot \BH \\
	&\leq |w(O[i])| \cdot \BH - |O[i]| \cdot \BH \\ % \Wbonus_\shareholder < \BH
	&= (|w(O[i])| - |O[i]|) \cdot \BH \\
	&\leq (|O[i]| - |w(O[i])|) \cdot \RH + \\
	& \qquad (|w(O[i])| - |O[i]|) \cdot \BH \\ % RH>0 and |w(O[i])| - |O[i]| <= 0
	&= |O[i]| \cdot (\RH - \BH) + \\
	& \qquad |w(O[i])| \cdot (\BH - \RH) \\
	&= \payoffs(C,O,w, honest)[i] + \\
	& \qquad |w(O[i])| \cdot (\BH - \RH) \\
	&\leq \payoffs(C,O,w, honest)[i] % BH < RH
	\end{split}
	\end{equation*}

	
	
	\item[$a = wSecret$:]
	%
	Then,  $\payoffs(C,O,w,s)[i] = |w(O[i])| \cdot \Wbonus_\shareholder  + V + \Wbonus_\secret  - |O[i]| \cdot \BH $.	
	%
	Since all other players pick the action $wait$, we have that $|w(O[i])| \leq k-1$ and $|O[i]| \geq k$.
	%
	Therefore, we have:
	\begin{equation*}
		\begin{split}
	\payoffs(C,O,w, s)[i] 
	&= |w(O[i])| \cdot \Wbonus_\shareholder  + V + \Wbonus_\secret  \\
	& \qquad - |O[i]| \cdot \BH \\
	&\leq (k-1) \cdot \Wbonus_\shareholder  + V + \Wbonus_\secret  \\
	& \qquad - |O[i]| \cdot \BH \\  % |w(O[i])| \leq k-1
	&\leq k \cdot \BH - |O[i]| \cdot \BH \\ % k \cdot \BH > V + \Wbonus_\secret + k-1 \Wbonus_\shareholder
	&\leq k \cdot \RH - |O[i]| \cdot \BH \\ % \BH < \RH
	&\leq |O[i]| \cdot \RH - |O[i]| \cdot \BH \\ % |O[i]| \geq k
	&= |O[i]| (\RH - \BH)\\
	&= \payoffs(C,O,w, honest)[i] 
	\end{split}
	\end{equation*}
\end{itemize}



\para{Correctness 2}
%
We want to prove that for all coalition $C$, all whistleblowing choices $w$, and all orderings $w$, 
for all valid strategies $s$:  $\mathit{payoffs}(C, O, w, s) \leq \mathit{payoffs}(C,O,w, honest)$.

\textcolor{red}{This might not hold!}
\end{comment}
\begin{comment}
\para{Sketch}
%
We now show that for all $i$, $\mathit{payoffs}(C, O, w, s)[i] \leq \mathit{payoffs}(C,O,w, honest)[i]$.
%
Observe that $\mathit{payoffs}(C,O,w, honest)[i]$ is always $|O[i]| \cdot (\RH - \BH)$.
%
There are three cases:
\begin{itemize}
\item[$s(i) = wait$:]
Then, $\mathit{payoffs}(C,O,w, s)[i]$ is either $|O[i]| \cdot (\RH - \BH)$ or $- |O[i]| \cdot \BH$.
%
In the first case, we have $\mathit{payoffs}(C,O,w, s)[i] = \mathit{payoffs}(C,O,w, honest)[i]$.
%
In the second case, we have 
\begin{equation*}
	\begin{split}
\payoffs(C,O,w, s)[i] 
 &= - |O[i]| \cdot \BH\\
 & < |O[i]| \cdot \RH -  |O[i]| \cdot \BH \\ % $\RH > 0$
 & = |O[i]| \cdot (\RH - \BH) \\
 & = \mathit{payoffs}(C,O,w, honest)[i]
\end{split}
\end{equation*}


\item[$s(i) = wShare$:]
%
Then, $\mathit{payoffs}(C,O,w, s)[i]$ is either $\payoffs(C,O,w,s)[i] = |w(O[i])| \cdot \Wbonus_\shareholder + (|O[i]| - |w(O[i])|) \cdot \RH - |O[i]| \cdot \BH $  or $|w(O[i])| \cdot \Wbonus_\shareholder - |O[i]| \cdot \BH $.
%
In the first case, we have ???
%
In the second case, we have 
\begin{equation*}
	\begin{split}
\payoffs(C,O,w, s)[i] 
&= |w(O[i])| \cdot \Wbonus_\shareholder - |O[i]| \cdot \BH \\
&< |w(O[i])| \cdot \BH - |O[i]| \cdot \BH \\ % \Wbonus_\shareholder < \BH
&= (|w(O[i])| - |O[i]|) \cdot \BH \\
&< (|O[i]| - |w(O[i])|) \cdot \RH + \\
& \qquad (|w(O[i])| - |O[i]|) \cdot \BH \\ % RH>0 and |w(O[i])| - |O[i]| <= 0
&= |O[i]| \cdot (\RH - \BH) + \\
& \qquad |w(O[i])| \cdot (\BH - \RH) \\
&= \payoffs(C,O,w, honest)[i] + \\
& \qquad |w(O[i])| \cdot (\BH - \RH) \\
&< \payoffs(C,O,w, honest)[i] % BH < RH
\end{split}
\end{equation*}

\item[$s(i) = wSecret$:]

\end{itemize}
\end{comment}

